<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex; 
      justify-content: center; 
      align-items: center; 
      min-height: 100vh; 
      direction: rtl; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
    }

    .container { 
      width: 100%; 
      max-width: 420px; 
      padding: 35px; 
      background: #fff; 
      border-radius: 20px; 
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    }

    h1 { 
      text-align: center; 
      margin-bottom: 30px;
      color: #2c3e50;
      font-size: 26px;
      font-weight: 600;
    }

    .tabs {
      display: flex;
      margin-bottom: 25px;
      border-bottom: 2px solid #eee;
      gap: 5px;
    }

    .tab {
      flex: 1;
      text-align: center;
      padding: 12px;
      cursor: pointer;
      color: #666;
      transition: all 0.3s ease;
      font-weight: 500;
      border-radius: 8px 8px 0 0;
      background: transparent;
      border: none;
      font-size: 15px;
    }

    .tab:hover {
      background: #f8f9fa;
    }

    .tab.active {
      color: #667eea;
      border-bottom: 3px solid #667eea;
      margin-bottom: -2px;
      background: #f8f9fa;
    }

    .form-group {
      margin-bottom: 20px;
      position: relative;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-size: 14px;
      font-weight: 500;
    }

    input { 
      width: 100%; 
      padding: 14px 14px;
      border: 2px solid #e0e0e0; 
      border-radius: 10px;
      font-size: 15px;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    .password-input {
      position: relative;
      display: flex;
      align-items: center;
    }

    .password-input input {
      padding-left: 45px;
    }

    .toggle-password {
      position: absolute;
      left: 12px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      color: #666;
      transition: color 0.3s;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
    }

    .toggle-password:hover {
      color: #667eea;
      background: #f8f9fa;
    }

    .eye-icon {
      font-size: 20px;
      user-select: none;
    }

    button.submit-btn { 
      width: 100%; 
      padding: 14px; 
      margin: 8px 0; 
      border: none; 
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s ease;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    button.submit-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    button.submit-btn:active:not(:disabled) {
      transform: translateY(0);
    }

    button.submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .error { 
      color: #dc3545; 
      text-align: center; 
      margin-top: 15px;
      padding: 12px;
      background: #fff5f5;
      border-radius: 8px;
      font-size: 14px;
      display: none;
      border: 1px solid #ffebee;
      line-height: 1.6;
    }

    .error.show {
      display: block;
      animation: slideDown 0.3s ease;
    }

    .success {
      color: #28a745;
      text-align: center;
      margin-top: 15px;
      padding: 12px;
      background: #f0fff4;
      border-radius: 8px;
      font-size: 14px;
      display: none;
      border: 1px solid #e8f5e9;
      line-height: 1.6;
    }

    .success.show {
      display: block;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .register-section {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #eee;
      text-align: center;
      color: #666;
      font-size: 14px;
    }

    .register-link {
      color: #667eea;
      cursor: pointer;
      text-decoration: none;
      margin-right: 5px;
      font-weight: 600;
      transition: color 0.3s;
    }

    .register-link:hover {
      color: #764ba2;
      text-decoration: underline;
    }

    .resend-btn {
      background: #28a745;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .resend-btn:hover {
      background: #218838;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
    }

    .loading {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid #ffffff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 0.6s linear infinite;
      margin-right: 8px;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .form-container {
      display: none;
    }

    .form-container.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>

<div class="container">
  <h1>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h1>
  
  <div class="tabs">
    <button class="tab active" id="employeeTab" type="button">Ù…ÙˆØ¸Ù</button>
    <button class="tab" id="adminTab" type="button">Ù…Ø¯ÙŠØ±</button>
  </div>

  <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸Ù -->
  <div id="employeeLoginForm" class="form-container active">
    <form id="empLoginForm">
      <div class="form-group">
        <label for="empEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input type="email" id="empEmail" placeholder="example@company.com" required autocomplete="email">
      </div>
      <div class="form-group">
        <label for="empPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <div class="password-input">
          <input type="password" id="empPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required autocomplete="current-password">
          <button type="button" class="toggle-password" data-target="empPassword">
            <span class="eye-icon">ğŸ‘ï¸</span>
          </button>
        </div>
      </div>
      <button type="submit" class="submit-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      <div id="empErrorBox" class="error"></div>
    </form>
  </div>

  <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† -->
  <div id="adminLoginForm" class="form-container">
    <form id="admLoginForm">
      <div class="form-group">
        <label for="adminEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input type="email" id="adminEmail" placeholder="admin@company.com" required autocomplete="email">
      </div>
      <div class="form-group">
        <label for="adminPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <div class="password-input">
          <input type="password" id="adminPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required autocomplete="current-password">
          <button type="button" class="toggle-password" data-target="adminPassword">
            <span class="eye-icon">ğŸ‘ï¸</span>
          </button>
        </div>
      </div>
      <button type="submit" class="submit-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      <div class="register-section">
        <span>Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ</span>
        <a href="#" class="register-link" id="showRegisterLink">ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</a>
      </div>
      <div id="adminErrorBox" class="error"></div>
    </form>
  </div>

  <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø£Ø¯Ù…Ù† Ø¬Ø¯ÙŠØ¯ -->
  <div id="adminRegisterForm" class="form-container">
    <form id="admRegForm">
      <div class="form-group">
        <label for="regFullName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
        <input type="text" id="regFullName" placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯" required autocomplete="name" minlength="3">
      </div>
      <div class="form-group">
        <label for="regEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input type="email" id="regEmail" placeholder="admin@company.com" required autocomplete="email">
      </div>
      <div class="form-group">
        <label for="regPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <div class="password-input">
          <input type="password" id="regPassword" placeholder="6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„" required minlength="6" autocomplete="new-password">
          <button type="button" class="toggle-password" data-target="regPassword">
            <span class="eye-icon">ğŸ‘ï¸</span>
          </button>
        </div>
      </div>
      <button type="submit" class="submit-btn">ØªØ³Ø¬ÙŠÙ„</button>
      <div class="register-section">
        <span>Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ</span>
        <a href="#" class="register-link" id="showLoginLink">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</a>
      </div>
      <div id="regErrorBox" class="error"></div>
      <div id="regSuccessBox" class="success"></div>
    </form>
  </div>
</div>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

  const supabaseUrl = "https://nxhnivykhlnauewpmuqv.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im54aG5pdnlraGxuYXVld3BtdXF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4Mjk2NTYsImV4cCI6MjA3NDQwNTY1Nn0.-3ps3Mp7aYuA2m54sW3gNN3CpZ2acRtKGj8jI5eHTOU";
  const supabase = createClient(supabaseUrl, supabaseKey);

  // Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø©
  const employeeTab = document.getElementById('employeeTab');
  const adminTab = document.getElementById('adminTab');
  const employeeFormContainer = document.getElementById('employeeLoginForm');
  const adminFormContainer = document.getElementById('adminLoginForm');
  const adminRegFormContainer = document.getElementById('adminRegisterForm');

  // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
  function clearMessages() {
    document.querySelectorAll('.error, .success').forEach(el => {
      el.classList.remove('show');
      el.innerHTML = '';
    });
  }

  // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¨ÙˆÙŠØ¨
  function switchTab(tab) {
    clearMessages();
    
    // Ø¥Ø²Ø§Ù„Ø© active Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ÙˆØ§Ù„Ù†Ù…Ø§Ø°Ø¬
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.form-container').forEach(f => f.classList.remove('active'));
    
    if (tab === 'employee') {
      employeeTab.classList.add('active');
      employeeFormContainer.classList.add('active');
    } else {
      adminTab.classList.add('active');
      adminFormContainer.classList.add('active');
    }
  }

  // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
  employeeTab.addEventListener('click', () => switchTab('employee'));
  adminTab.addEventListener('click', () => switchTab('admin'));

  // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙˆØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø£Ø¯Ù…Ù†
  function showAdminRegister(e) {
    e.preventDefault();
    clearMessages();
    adminFormContainer.classList.remove('active');
    adminRegFormContainer.classList.add('active');
  }

  function showAdminLogin(e) {
    e.preventDefault();
    clearMessages();
    adminFormContainer.classList.add('active');
    adminRegFormContainer.classList.remove('active');
  }

  document.getElementById('showRegisterLink').addEventListener('click', showAdminRegister);
  document.getElementById('showLoginLink').addEventListener('click', showAdminLogin);

  // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
  document.querySelectorAll('.toggle-password').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      const targetId = btn.getAttribute('data-target');
      const input = document.getElementById(targetId);
      if (input.type === 'password') {
        input.type = 'text';
        btn.querySelector('.eye-icon').textContent = 'ğŸ‘ï¸â€ğŸ—¨ï¸';
      } else {
        input.type = 'password';
        btn.querySelector('.eye-icon').textContent = 'ğŸ‘ï¸';
      }
    });
  });

  // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯
  async function resendConfirmation(email, errorBoxId) {
    const errorBox = document.getElementById(errorBoxId);
    try {
      const { error } = await supabase.auth.resend({
        type: 'signup',
        email: email
      });
      if (error) throw error;
      errorBox.className = 'success show';
      errorBox.innerText = 'âœ“ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ£ÙƒÙŠØ¯. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.';
    } catch (err) {
      console.error(err);
      errorBox.className = 'error show';
      errorBox.innerText = 'âŒ ' + (err.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ£ÙƒÙŠØ¯');
    }
  }

  // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸Ù
  document.getElementById('empLoginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const errorBox = document.getElementById('empErrorBox');
    const submitBtn = e.target.querySelector('button[type="submit"]');
    clearMessages();

    const email = document.getElementById('empEmail').value.trim();
    const password = document.getElementById('empPassword').value.trim();

    if (!email || !password) {
      errorBox.className = 'error show';
      errorBox.innerText = 'âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
      return;
    }

    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="loading"></span> Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...';

    try {
      const { data, error } = await supabase.auth.signInWithPassword({ email, password });
      
      if (error) {
        if (error.message.includes('Email not confirmed') || error.message.includes('not confirmed')) {
          errorBox.className = 'error show';
          errorBox.innerHTML = `
            âŒ Ù„Ù… ÙŠØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¨Ø¹Ø¯.
            <br><br>
            <button class="resend-btn" type="button" id="empResendBtn">
              Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ£ÙƒÙŠØ¯
            </button>
          `;
          document.getElementById('empResendBtn').addEventListener('click', () => {
            resendConfirmation(email, 'empErrorBox');
          });
          return;
        }
        if (error.message.includes('Invalid login credentials')) {
          throw new Error('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
        }
        throw error;
      }

      if (!data.user) {
        throw new Error('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
      }

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      const { data: userData, error: userError } = await supabase
        .from('users')
        .select('role, status')
        .eq('id', data.user.id)
        .single();

      if (userError) {
        console.error('User role check error:', userError);
        throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
      }

      if (!userData) {
        throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
      }

      if (userData.role !== 'employee') {
        await supabase.auth.signOut();
        throw new Error('Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„ÙŠØ³ Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¸Ù');
      }

      if (userData.status !== 'active') {
        await supabase.auth.signOut();
        throw new Error('Ø­Ø³Ø§Ø¨Ùƒ ØºÙŠØ± Ù†Ø´Ø·. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©');
      }

      window.location.href = "/employee-dashboard.html";
    } catch (err) {
      console.error('Login error:', err);
      errorBox.className = 'error show';
      errorBox.innerText = "âŒ " + (err.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerHTML = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
    }
  });

  // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†
  document.getElementById('admLoginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const errorBox = document.getElementById('adminErrorBox');
    const submitBtn = e.target.querySelector('button[type="submit"]');
    clearMessages();

    const email = document.getElementById('adminEmail').value.trim();
    const password = document.getElementById('adminPassword').value.trim();

    if (!email || !password) {
      errorBox.className = 'error show';
      errorBox.innerText = 'âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
      return;
    }

    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="loading"></span> Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...';

    try {
      const { data, error } = await supabase.auth.signInWithPassword({ email, password });
      
      if (error) {
        if (error.message.includes('Email not confirmed') || error.message.includes('not confirmed')) {
          errorBox.className = 'error show';
          errorBox.innerHTML = `
            âŒ Ù„Ù… ÙŠØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¨Ø¹Ø¯.
            <br><br>
            <button class="resend-btn" type="button" id="adminResendBtn">
              Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ£ÙƒÙŠØ¯
            </button>
          `;
          document.getElementById('adminResendBtn').addEventListener('click', () => {
            resendConfirmation(email, 'adminErrorBox');
          });
          return;
        }
        if (error.message.includes('Invalid login credentials')) {
          throw new Error('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
        }
        throw error;
      }

      if (!data.user) {
        throw new Error('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
      }

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      const { data: userData, error: userError } = await supabase
        .from('users')
        .select('role, status')
        .eq('id', data.user.id)
        .single();

      if (userError) {
        console.error('User role check error:', userError);
        throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
      }

      if (!userData) {
        throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
      }

      if (userData.role !== 'admin') {
        await supabase.auth.signOut();
        throw new Error('Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„ÙŠØ³ Ø­Ø³Ø§Ø¨ Ù…Ø¯ÙŠØ±');
      }

      if (userData.status !== 'active') {
        await supabase.auth.signOut();
        throw new Error('Ø­Ø³Ø§Ø¨Ùƒ ØºÙŠØ± Ù†Ø´Ø·');
      }

      window.location.href = "/admin-dashboard.html";
    } catch (err) {
      console.error('Login error:', err);
      errorBox.className = 'error show';
      errorBox.innerText = "âŒ " + (err.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerHTML = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
    }
  });

  // ØªØ³Ø¬ÙŠÙ„ Ø£Ø¯Ù…Ù† Ø¬Ø¯ÙŠØ¯
  document.getElementById('admRegForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const errorBox = document.getElementById('regErrorBox');
    const successBox = document.getElementById('regSuccessBox');
    const submitBtn = e.target.querySelector('button[type="submit"]');
    clearMessages();

    const full_name = document.getElementById('regFullName').value.trim();
    const email = document.getElementById('regEmail').value.trim();
    const password = document.getElementById('regPassword').value.trim();

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    if (full_name.length < 3) {
      errorBox.className = 'error show';
      errorBox.innerText = 'âŒ Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„';
      return;
    }

    if (password.length < 6) {
      errorBox.className = 'error show';
      errorBox.innerText = 'âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„';
      return;
    }

    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="loading"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';

    try {
      // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Auth
      const { data, error } = await supabase.auth.signUp({
        email,
        password,
        options: { 
          data: { 
            full_name,
            role: 'admin'
          }
        }
      });

      if (error) throw error;

      if (!data.user) {
        throw new Error('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨');
      }

      const userId = data.user.id;

      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø¬Ø¯ÙˆÙ„ users
      const { error: insertError } = await supabase
        .from('users')
        .insert({ 
          id: userId, 
          full_name, 
          email, 
          role: 'admin', 
          status: 'active' 
        });

      if (insertError) {
        console.error('Insert error:', insertError);
        // Ù…Ø­Ø§ÙˆÙ„Ø© Update Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø¬Ù„ Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        const { error: updateError } = await supabase
          .from('users')
          .update({ 
            full_name, 
            role: 'admin', 
            status: 'active',
            updated_at: new Date().toISOString()
          })
          .eq('id', userId);
        
        if (updateError) {
          console.error('Update error:', updateError);
        }
      }

      // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
      successBox.className = 'success show';
      successBox.innerHTML = `
        âœ“ ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! 
        <br><br>
        ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· ØªØ£ÙƒÙŠØ¯ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ. 
        <br>
        ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù‚Ø¨Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.
      `;
      
      // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„
      document.getElementById('regFullName').value = '';
      document.getElementById('regEmail').value = '';
      document.getElementById('regPassword').value = '';
      
      setTimeout(() => {
        showAdminLogin({ preventDefault: () => {} });
      }, 3000);

    } catch (err) {
      console.error('Registration error:', err);
      errorBox.className = 'error show';
      let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„';
      
      if (err.message.includes('already registered') || err.message.includes('already been registered')) {
        errorMessage = 'Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„';
      } else if (err.message.includes('invalid email')) {
        errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­';
      } else if (err.message.includes('Password')) {
        errorMessage = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„';
      } else if (err.message) {
        errorMessage = err.message;
      }
      
      errorBox.innerText = "âŒ " + errorMessage;
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerHTML = 'ØªØ³Ø¬ÙŠÙ„';
    }
  });

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
  (async () => {
    try {
      const { data: { session }, error } = await supabase.auth.getSession();
      
      if (error) {
        console.error('Session check error:', error);
        return;
      }
      
      if (session) {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØªÙˆØ¬ÙŠÙ‡Ù‡ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
        const { data: userData, error: userError } = await supabase
          .from('users')
          .select('role')
          .eq('id', session.user.id)
          .single();

        if (userError) {
          console.error('User data error:', userError);
          return;
        }

        if (userData?.role === 'admin') {
          window.location.href = "/admin-dashboard.html";
        } else if (userData?.role === 'employee') {
          window.location.href = "/employee-dashboard.html";
        }
      }
    } catch (err) {
      console.error('Initialization error:', err);
    }
  })();
</script>

</body>
</html>